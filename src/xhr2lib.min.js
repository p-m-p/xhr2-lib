/*! Copyright (c) 2012 Phil Parsons http://philparsons.co.uk/licence */
(function(i){i.$xhr=function(){var e={},j,k;e.supported=function(){return"undefined"!==typeof(new XMLHttpRequest).upload&&"undefined"!==typeof i.FormData&&"undefined"!==typeof i.File};e.defaultError=function(a){"function"===typeof a&&(j=a);return this};e.defaultSuccess=function(a){"function"===typeof a&&(k=a);return this};e.get=function(){return e.ajax(f(arguments))};e.getJSON=function(){return e.ajax(g(f(arguments),{dataType:"json"}))};e.getXML=function(){return e.ajax(g(f(arguments),{dataType:"xml"}))};
e.post=function(){return e.ajax(g(f(arguments),{type:"post"}))};e.sendForm=function(){var a,b=arguments[0],d=Array.prototype.slice.call(arguments,1);if(b&&"FORM"===b.nodeName)return a=new FormData(b),d.unshift(b.action||i.location.href),a=g(f(d),{type:b.method||"post",data:a}),e.ajax(a);throw Error("HTMLFormElement expected");};e.sendFile=function(){var a=f(arguments);return e.ajax(g(a,{type:"post",headers:{"X-File-Name":a.data.name}}))};e.ajax=function(a){var b=new XMLHttpRequest,d=b.upload,c=g({progress:!1,
type:"get",dataType:"html",async:!0,username:null,password:null,timeout:0,withCredentials:!1},a),h;c.type=c.type.toLowerCase();if("object"===typeof c.data&&!e.isTypeOf(c.data,"formdata")&&!e.isTypeOf(c.data,"file"))if("get"===c.type)c.url=e.serialize(a.data,a.url),c.data=null;else{a=new FormData;for(h in c.data)c.data.hasOwnProperty(h)&&a.append(h,e.isTypeOf(c.data[h],"array")?c.data[h].join():c.data[h]);c.data=a}if("function"===typeof c.progress)d.callback=c.progress,d.onprogress=n;if(0<c.timeout)c.timer=
setTimeout(function(){var a=b,c=l(a);a.abort();c&&c.call(a,"timeout",a.status);b=void 0;b=null},c.timeout);b.open(c.type,c.url,c.async,c.username,c.password);b.withCredentials=c.withCredentials;o(b,c.dataType,c.headers);b.xhr2data=c;b.onreadystatechange=p;b.onerror=m;b.send(c.data);return b};e.serialize=function(a,b){var d="";b&&"string"===typeof b?d=-1===b.indexOf("?")?"?":"&":b="";if("object"===typeof a)for(var c in a)a.hasOwnProperty(c)&&(d+=c+"="+a[c]+"&");return b+d.substr(0,d.length-1)};e.isTypeOf=
function(a,b){var d=a.constructor.toString().toLowerCase(),b=b.replace(/^\s*|\s*$/,"").toLowerCase();return-1!==d.indexOf(b)};var f=function(a){for(var b=0,d={url:a[0]},a=Array.prototype.slice.call(a,1),c=!1;b<a.length;++b)switch(typeof a[b]){case "string":d.dataType=a[b];break;case "function":c?d.progress=a[b]:(d.success=a[b],c=!0);break;case "object":d.data=a[b]}return d},g=function(){var a={},b=0,d;if(arguments.length&&"undefined"!==typeof arguments[0])for(;b<arguments.length;++b)for(d in arguments[b])arguments[b].hasOwnProperty(d)&&
(a[d]=arguments[b][d]);return a},p=function(a){var b,d=a.target,c=d.xhr2data||{},e;if(d.readyState===d.DONE)switch(e=Math.round(d.status/100),c.timer&&clearTimeout(c.timer),e){case 2:a=c&&c.success?c.success:k?k:void 0;if("function"===typeof a){if("json"===c.dataType)try{b=JSON.parse(d.responseText)}catch(f){}else b="xml"===c.dataType?d.responseXML:d.responseText;a.call(d,b)}break;case 4:case 5:m(a)}},n=function(a){a&&a.lengthComputable&&a.target.callback.call(a,100*Math.round(a.loaded/a.total))},
o=function(a,b,d){var c;switch((b||"").toLowerCase()){case "json":b="application/json, text/javascript, ";break;case "xml":b="text/xml, application/xml, ";break;case "text":b="text/plain, ";break;default:b="text/html, "}a.setRequestHeader("Accept",b+"*/*;q=0.01");a.setRequestHeader("X-Requested-With","XMLHttpRequest");if("object"===typeof d)for(c in d)d.hasOwnProperty(c)&&a.setRequestHeader(c,d[c])},m=function(a){var a=a.target,b;a&&(b=l(a))&&b.call(a,a.statusText,a.status)},l=function(a){if(a.xhr2data&&
"function"===typeof a.xhr2data.error)return a.xhr2data.error;if(j)return j};return e}()})(window);